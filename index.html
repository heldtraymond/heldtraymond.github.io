<html>
<head>
	<title>Golf</title>
	<!--meta name="viewport" content="width=device-width,initial-scale=1.0"-->
	<meta charset="UTF-8">
	<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@800&display=swap" rel="stylesheet">
	<style>
		body {
			text-align:center;
			font-family:'Tahoma', Verdana, sans-serif;
		}
		.widthTest {
			font-family:'Roboto Slab', Tahoma, sans-serif;
			font-size:50pt;
			opacity:0;
			position:absolute;
			left:0px;
			top:0px;
			z-index:-2;
		}
		#playTableContainer {
			width:100%;
			display:inline-block;
			/*padding-left:30px;
			padding-right:30px;*/
		}
		#playTable {
			width:100%;
			border-collapse:collapse;
		}
		.dealerLabel {
			display:none;
			font-weight:bold;
			position:relative;
			margin-bottom:-1.5em;
			margin-top:0px;
			height:1.5em;
			z-index:104;
		}
		.dealerLabel span {
			color:white;
			border:5px solid #ff0000;
			border-radius:5px;
			background-color:#ff0000;
		}
		/*#playTable tr, #playTable td {
			border:none;
		}*/
		.infoOnly {
			width:11%;
		}
		.playerCards {
			width:13%;
			padding-left:10px;
			padding-right:10px;
		}
		#centerCell .card {
			width:1.4em;
		}
		#centerCell {
			font-size:12pt;
		}
		.endplayer .card {
			border-color:red;
			background-color:#ffdddd;
		}
		.card {
			font-family:'Roboto Slab', Tahoma, sans-serif;
			border:2px solid black;
			border-radius:6px;
			background-color:white;
			font-size:24pt;
			font-weight:bolder;
			width:33%;
			text-align:center;
			line-height:87%;
			letter-spacing:-3;
			padding-right:3px;
			padding-top:0px;
			padding-bottom:5px;
			height:2.2em;
		}
		#playTable tr td {
			/*padding-bottom:8px;*/
		}
		.red {
			color:red;
		}
		.black {
			color:black;
		}
		.joker {
			color:black;
			letter-spacing:0;
			padding-right:0px;
			line-height:65%;
		}
		.jokerText {
			font-size:8pt;
		}
		.suit {
			width:100%;
			font-size:33pt;
		}
		.facedown {
			background-repeat:no-repeat;
			background-size:contain;
			background-position:center;
		}
		.facedown.deck1 {
			background-image:url('cardBackBicycle.png');
			background-color:#252760;
		}
		.facedown.deck2 {
			background-image:url('cardBackDominos2.png');
			background-color:#000000;
		}
		.playerCell {
			font-style:bold;
		}
		.playerInfo {
			text-align:center;
		}
		.playerInfoWrapper {
			max-width:80px;
		}
		/*.cellComponent.endplayer {
			background-color:#ff0000;
		}*/
		.playerCards.live.current {
			background-color:blue;
			border-radius:6px;
		}
		/*.playerInfo.live.current img {
			border-color:#8833bb;
		}
		.playerInfo.live.firstPlayer img {
			border-color:#8833bb;
		}*/
		.playerCards.current {
			background-color:#8833bb;
			border-radius:6px;
		}
		.playerInfo.live.firstPlayer img {
			border-color:#8833bb;
		}
		.playerInfo.firstPlayer img {
			border:5px solid #8833bb;
			margin:-2px -2px -2px -2px;
		}
		.playerInfo.current img {
			border:7px solid #8833bb;
			margin:-5px -5px -5px -5px;
		}
		/*.playerInfo.live {
			background-color:#77ff77;
		}*/
		.playerInfo.live img {
			border:8px solid blue;
			margin:-5px -5px -5px -5px;
		}
		.playerInfo img {
			background-color:white;
			border-radius:8px;
			border:3px solid black;
			max-height:80px;
			position:relative;
		}
		.playerName {
			margin-top:0px;
			margin-bottom:0px;
    		font-size:12pt;
			position:relative;
			z-index:100;
		}
		.endplayer .playerName span {
			background-color:#ffdddd;
			border-color:red;
		}
		.playerName span {
			color:black;
			border-radius:4px;
			background-color:#ccccff;
			border:2px solid #000088;
			padding-left:3px;
			padding-right:3px;
			display:inline-block;
			margin-top:-1.3em;
			margin-bottom:-1.3em;
			min-height:1.3em;
			min-width:1.3em;
		}
    	.playerCards table {
    		width:100%;
    		table-layout:fixed;
    	}
    	.card.discard {
    		background-color:#ff8888;
    		background-image:url('discard.png');
			background-repeat:no-repeat;
			background-size:contain;
			background-position:center;
    	}
    	.card.discard:hover {
    		background-color:#ff0000 !important;
    	}
    	.card.selectedCard:hover {
    		background-color:#aaaaff !important;
    	}
    	.card.selectedCard {
    		background-color:#aaaaff !important;
    	}
    	.card.playableCard:hover {
    		cursor:pointer;
    		background-color:#66dd66;
    		/*border-color:green;*/
    	}
    	/*.playerCards.live .facedown:hover {
    		cursor:pointer;
    		background-color:#66dd66;
    		border-color:#ffff88;
    		background-image:none;
    	}*/
    	.card:hover {
    		cursor:not-allowed;
    	}
    	.playerInfo.right {
    		text-align:right;
    	}
    	.playerInfo.left {
    		text-align:left;
    	}
    	.playerInfoWrapper br {
			display:none;
    	}
    	#middleRow, #middleRow > td {
    		padding-top:5px;
    		padding-bottom:3px;
    	}
    	#centerCell {
    		text-align:center;
    	}
    	#toggleNamesBox {
    		margin-right:6px;
    	}
    	#toggleScoresBox {
    		margin-left:6px;
    	}
    	#toggleScoresBox, #toggleNamesBox {
    		height:20px;
    		width:20px;
    	}
    	#toggleScoresBox, #toggleNamesBox, .toggleLabel {
    		vertical-align:middle;
    		cursor:pointer;
    	}
    	#toggleScores:hover, #toggleNames:hover {
    		cursor:pointer;
    		background-color:#bbbbff;
    		border:2px solid #000088;
    		border-radius:6px;
    		padding-top:2px;
    		padding-right:4px;
    		padding-left:4px;
    	}
    	#toggleScores, #toggleNames {
    		padding:6px;
    	}
    	#overlayContainer {
    		text-align:center;
    		width:100%;
    		position:absolute;
    		left:0;
    		z-index:100;
    		display:none;
    		top:0;
    	}
    	#overlayBackground {
    		width:100%;
    		position:absolute;
    		height:100%;
    		left:0;
    		background-color:black;
    		opacity:50%;
    		z-index:-1;
    	}
    	#instructions {
    		opacity:100%;
    		text-align:left;
    		width:13em;
    		display:inline-block;
    		padding:1.7em;
    		border: 4px solid black;
    		border-radius:10px;
    		background-color:white;
    		font-family:'Times New Roman';
    		font-size:24pt;
    		line-height:150%;
    	}
    	.scoringSettings {
			padding:0px;
			margin:0px;
    	}
		.scoringSettings li {
			display: flex;
			padding-left:0px;
			margin-left:0px;
		}

		.scoringSettings li .cardType {
			order: 1;
		}

		.scoringSettings li .cardPoints {
			order: 3;
		}

		.scoringSettings li::after {
			content: "";
			border-bottom: 4px dotted;
			flex-grow: 1;
			order: 2;
			margin-bottom:0.4em;
			margin-left:0.1em;
			margin-right:0.1em;
		}

		#roundByRound {
    		opacity:100%;
    		text-align:left;
    		display:inline-block;
    		border: 4px solid black;
    		border-radius:10px;
    		background-color:white;
    		padding:1em;
    		margin-top:1em;
    		position:relative;
		}

		#roundByRoundTable {
			font-family:'Roboto Slab', Tahoma, sans-serif;
    		font-size:20pt;
    		border-collapse:collapse;
    		display:inline-block;
		}

		#roundByRoundTable td {
			border-top:1px solid #006600;
			border-bottom:1px solid #006600;
		}

		#roundByRoundTable tr td:nth-child(1) {
			text-align:right;
			/*background-color:#88bb88 !important;*/
		}
		#roundByRoundTable tr th:nth-child(1) {
			text-align:right;
		}

		#roundByRoundTable tr td:nth-child(even) {
			background-color:#aaeeaa;
			color:#000000;
		}

		#roundByRoundTable tr td:nth-child(2) {
			background-color:#006600;
			color:white !important;
			/*border-right:3px solid black !important;*/
		}

		#roundByRoundTable th, #roundByRoundTable td {
			padding:3px 7px 3px 7px;
			text-align:center;
			min-width:1em;
		}

		#roundByRoundTable th {
			background-color:#006600;
			color:white;
		}

		.buttonContainer {
			text-align:center;
		}

		.overlayCloseButton {
			font-family:'Roboto Slab', Tahoma, sans-serif;
    		font-size:14pt;
    		padding:5px;
    		margin-top:10px;
    		background-color:#8833bb;
    		border-radius:7px;
    		cursor:pointer;
    		color:white;
		}

		.scoreImg {
			height: 1.2em;
			margin-right: 4px;
			margin-bottom:-0.2em;
		}


		</style>
	<script src="jquery.js"></script>
</head>
<body style="overflow-y:scroll;text-align:center;">
	<span class="widthTest" id="widthTestValue">A</span>
	<span class="widthTest" id="widthTestSuit">♣</span>
	<img id="bgPhoto" src="LivingRoom_1.jpg" style="width:100%;position:absolute;left:0px;top:0px;z-index:-1">
	<div id="playTableContainer">
		<table id="playTable">
			<tr>
				<td class="infoOnly"></td>
				<td></td>
				<td class="playerInfo cellComponent" id="playerInfo0">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo1">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo2">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo3">
				</td>
				<td></td>
				<td class="infoOnly"></td>
			</tr>
			<tr>
				<td class="playerInfo cellComponent right" id="playerInfo13">
				</td>
				<td class="playerCards cellComponent" id="playerCards13">
				</td>
				<td class="playerCards cellComponent" id="playerCards0">
				</td>
				<td class="playerCards cellComponent" id="playerCards1">
				</td>
				<td class="playerCards cellComponent" id="playerCards2">
				</td>
				<td class="playerCards cellComponent" id="playerCards3">
				</td>
				<td class="playerCards cellComponent" id="playerCards4">
				</td>
				<td class="playerInfo cellComponent left" id="playerInfo4">
				</td>
			</tr>
			<tr id="middleRow">
				<td class="playerInfo cellComponent right" id="playerInfo12">
				</td>
				<td class="playerCards cellComponent" id="playerCards12">
				</td>
				<td colspan="4" id="centerCell"></td>
				<td class="playerCards cellComponent" id="playerCards5">
				</td>
				<td class="playerInfo cellComponent left" id="playerInfo5">
				</td>
			</tr>
			<tr>
				<td class="playerInfo cellComponent right" id="playerInfo11">
				</td>
				<td class="playerCards cellComponent" id="playerCards11">
				</td>
				<td class="playerCards cellComponent" id="playerCards10">
				</td>
				<td class="playerCards cellComponent" id="playerCards9">
				</td>
				<td class="playerCards cellComponent" id="playerCards8">
				</td>
				<td class="playerCards cellComponent" id="playerCards7">
				</td>
				<td class="playerCards cellComponent" id="playerCards6">
				</td>
				<td class="playerInfo cellComponent left" id="playerInfo6">
				</td>
			</tr>
			<tr>
				<td class="infoOnly"></td>
				<td></td>
				<td class="playerInfo cellComponent" id="playerInfo10">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo9">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo8">
				</td>
				<td class="playerInfo cellComponent" id="playerInfo7">
				</td>
				<td></td>
				<td class="infoOnly"></td>
			</tr>
		</table>
	</div>
	<div id="overlayContainer">
		<div id="overlayBackground"></div>
		<span id="roundByRound" class="overlayContent">
			<table id="roundByRoundTable">
				<tr>
					<th>Player</th>
					<th>Total</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>6</th>
					<th>7</th>
					<th>8</th>
					<th>9</th>
				</tr>
			</table>
			<div class="buttonContainer">
				<button class="overlayCloseButton" id="roundByRoundCloseButton" onclick="RoundByRoundClose()">Begin Next Round</button>
			</div>
		</span>
		<span id="instructions" class="overlayContent">
			<u><i><strong>GOLF</strong></i></u>
			<ul class="scoringSettings">
			  <li>
			    <span class="cardType">Ace</span>
			    <span class="cardPoints"><strong>1</strong> point</span>
			  </li>
			  <li>
			    <span class="cardType">King</span>
			    <span class="cardPoints"><strong>0</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">Queen</span>
			    <span class="cardPoints"><strong>10</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">Jack</span>
			    <span class="cardPoints"><strong>20</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">Joker</span>
			    <span class="cardPoints"><strong>-3</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">All others</span>
			    <span class="cardPoints"><strong>face</strong> value</span>
			  </li>
			  <br>
			  <li>
			    <span class="cardType">All 4 corners</span>
			    <span class="cardPoints"><strong>-20</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">4 next to each other</span>
			    <span class="cardPoints"><strong>-20</strong> points</span>
			  </li>
			  <li>
			    <span class="cardType">All 6</span>
			    <span class="cardPoints"><strong>-30</strong> points</span>
			  </li>
			</ul>
		</span>
	</div>
</body>
<script>
	var DECK = [];
	var NAMES = [
		"Samantha",
		"Diane",
		"Tracy",
		"David",
		"Jeff",
		"Lauren",
		"Michael",
		"Elizabeth",
		"Nicholas",
		"Justin",
		"Michelle",
		"Nicole",
		"Angela",
		"Ray",
	];
	var ROUND_NUM = 0;
	var DRAW_INDEX = 0;
	var PLAYERS = [];
	var SELECTED_CARD = null;
	var DRAWING_TWO = false;

	for (var i = 0; i < NAMES.length; i++) {
		if (Math.random() < 0.99) {
			PLAYERS.push({
				name: NAMES[i],
				scores: [0,0,0,0,0,0,0,0,0],
				isLive: Math.random() < 0.1
			});
		}
	}

	var CLOCK_INTERVAL = null;
	var COUNTDOWN_TIME = null;

	var TOTAL_SEATS = 14;
	var SEATS = [];
	var DEALER = null;
	var CURRENT_SEAT = null;
	var START_SEAT = null;
	var END_SEAT = null;

	var SUITS = ["♥", "♠", "♦", "♣"];
	var VALS = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

	var SHOW_SCORES = true; // (Math.random() > 0.5);	
	var SHOW_NAMES = (Math.random() > 0.5);
	var PREV_SHOW_SCORES = SHOW_SCORES;

	var LAST_RESIZE = new Date();
	var LAST_WINDOW_SIZE = window.innerWidth;

	Setup();
	DrawRoundByRound();
	//BeginNextRound();

	function ChooseLivePlayers() {

	}

	function DrawRoundByRound() {
		var PlayerScores = [];
		for (var i = 0; i < TOTAL_SEATS; i++) {
			if (SEATS[i] !== null) {
				var total = 0;
				for (var r = 0; r < 9; r++) {
					total += SEATS[i].scores[r];
				}
				PlayerScores.push({
					name: SEATS[i].name,
					scores: SEATS[i].scores,
					total: total,
					isLive: SEATS[i].isLive
				});
			}
		}

		PlayerScores.sort(function(a, b) {
			return (a.total > b.total ? -1 : (a.total < b.total ? 1 : (a.name < b.name ? -1 : 1)));
		});

		var lastPlaceScore = (ROUND_NUM < 1 ? 1 : PlayerScores[0].total);

		$("#roundByRoundTable tr").each(function(index) {
			if (index <= 0) return;

			var player = PlayerScores[index - 1];
			$(this).find("td").eq(0).html((player.total >= lastPlaceScore ? "<img src='trophy.png' class='scoreImg'>" : "") + player.name);
			$(this).find("td").eq(1).html(player.total);
			$(this).find("td").css("background-color", "");
			for (var r = 0; r < 9; r++) {
				$(this).find("td").eq(2 + r).html(r < ROUND_NUM ? player.scores[r] : "");
			}

			if (player.isLive) {
				$(this).find("td").each(function(index) {
					$(this).css("background-color", (index % 2 === 0 ? "#ffdddd" : (index === 1 ? "#aa0000" : "#ff9999")));
				});
			}
		});

		ShowRoundByRound();
	}

	function Setup() {
		$(window).resize(SafeFitToWindow);

		for (var i = 0; i < TOTAL_SEATS; i++) {
			SEATS.push(null);
		}

		for (var i = 0; i < PLAYERS.length; i++) {
			var seat = -1;
			while (seat < 0 || SEATS[seat] !== null) {
				seat = Math.floor(Math.random() * TOTAL_SEATS);
			}

			SEATS[seat] = PLAYERS[i];

			var round = $("<tr></tr>");
			for (var col = 0; col < 11; col++) {
				round.append("<td></td>");
			}
			$("#roundByRoundTable").append(round);
		}

		$(".playerInfo").each(function() {
			var span = $("<span></span>");
			span.addClass("playerInfoWrapper");
			var name = $("<p><span></span></p>");
			name.addClass("playerName");
			var img = $("<img>");
			img.attr("src", "User.png");
			var dealer = $("<p><span>DEALER</span></p>");
			dealer.addClass("dealerLabel");
			var id = parseInt($(this).attr("id").substring(10));
			if (id >= 40 && id <= 3) {
				span.append(name);
				span.append(img);
				span.append(dealer);
			}
			else {
				span.append(img);
				span.append(dealer);
				span.append(name);
			}
			$(this).append(span);
		});
		$(".playerCards").each(function() {
			var id = parseInt($(this).attr("id").substring(11));
			var table = $("<table></table>");
			for (var r = 0; r < 2; r++) {
				var tr = $("<tr></tr>");
				for (var c = 0; c < 3; c++) {
					var td = $("<td></td>");
					td.addClass("card");
					td.attr("seatNum", id);
					td.attr("cardNum", (r * 3 + c));
					//if (id === livePlayer) {
						td.attr("onclick", "ClickedCard(this," + id + "," + (r * 3 + c) + ")");
					//}
					tr.append(td);
				}
				table.append(tr);
			}
			$(this).append(table);
		});
		var status = $("<span id='statusText'></span>");
		var span = $("<span style='display:inline-block;text-align:center;'><span id='roundNum'></span></span>");
		var innerSpan = $("<span></span>");
		var table = $("<table align='center'></table>");
		var tr = $("<tr></tr>");
		table.append(tr);
		for (var c = 0; c < 3; c++) {
			var td = $("<td></td>");
			if (c !== 1) {
				td.addClass("card");
			}
			if (c === 0) {
				td.attr("onclick", "ClickedDiscard()");
			}
			if (c === 2) {
				td.attr("onclick", "ClickedDrawCard()");
			}
			tr.append(td);
		}
		innerSpan.append(table);
		span.append(innerSpan);
		span.append("<span id='toggleNames'><label class='toggleLabel' for='toggleNamesBox'>Show names</label><input type='checkbox' id='toggleNamesBox' onclick='ToggleNames()' /></span>");
		span.append("<span id='toggleScores'><input type='checkbox' id='toggleScoresBox' onclick='ToggleScores()' /><label class='toggleLabel' for='toggleScoresBox'>Show scores</label></span>");
		$("#centerCell").append(span);
		$("#centerCell").append(status);

		$("#statusText").hide();

		for (var i = 0; i < TOTAL_SEATS; i++) {
			if (SEATS[i] === null) {
				$("#playerInfo" + i + " img").hide();
				$("#playerInfo" + i + " .playerName").hide();
				$("#playerCards" + i + " table").hide();
			}
			else {
				if (SEATS[i].isLive) {
					$("#playerInfo" + i).addClass("live");
					$("#playerCards" + i).addClass("live");
				}
				//if (SEATS[i].name === "Angela" || SEATS[i].name === "Ray") {
					$("#playerInfo" + i + " img").attr("src", "players/" + SEATS[i].name + ".jpg");
				//}
				//else {
				//	$("#playerInfo" + i + " img").attr("src", "User.png");
				//}
			}
		}

		if (SHOW_SCORES || SHOW_NAMES) {
			$(".playerName").css("opacity", "0");
		}
		else {
			$(".playerName").hide();
		}

		$(".playerInfo, .playerName").css("opacity", "0");
		$(".playerCards .card").css("opacity", "0");
		$("#centerCell>span").hide();
	}

	function BeginNextRound() {
		ROUND_NUM++;
		if (ROUND_NUM <= 9) {
			ShuffleUpAndDeal();
		}
	}

	function RoundByRoundClose() {
		HideOverlay();
		BeginNextRound();
	}

	function ShuffleUpAndDeal() {
		END_SEAT = null;
		if (START_SEAT === null) {
			START_SEAT = Math.floor(Math.random() * TOTAL_SEATS);
			IncrementCurrent(false);
			DEALER = CURRENT_SEAT;
		}
		else {
			// Round 2 or later - dealer was last hand's first player
			DEALER = START_SEAT;
		}

		CURRENT_SEAT = DEALER;
		IncrementCurrent(false);
		START_SEAT = CURRENT_SEAT;

		setTimeout(function() {
			FitToWindow(true);
		}, 500);

		$(".card").css("opacity", 0);
		$(".playerName").hide();
		$("#playerInfo11, #playerInfo12, #playerInfo13").find("img, .dealerLabel").css("left", "125px").css("top", "11px");
		$("#playerInfo4, #playerInfo5, #playerInfo6").find("img, .dealerLabel").css("left", "-123px").css("top", "11px");
		$("#playerInfo0, #playerInfo1, #playerInfo2, #playerInfo3").find("img, .dealerLabel").css("top", "100px");
		$("#playerInfo7, #playerInfo8, #playerInfo9, #playerInfo10").find("img, .dealerLabel").css("top", "-80px");

		$("#statusText").html("Shuffling").hide();
		$("#toggleScoresBox").prop("checked", SHOW_SCORES);
		$("#toggleNamesBox").prop("checked", SHOW_NAMES);
		$("#roundNum").html("Round " + ROUND_NUM + " of 9");
		for (var i = 0; i < 108; i++) {
			DECK[i] = -(i + 1);
		}

		for (var i = 0; i < 108; i++) {
			var randInt = i + Math.floor(Math.random() * (108-i));
			var temp = DECK[i];
			DECK[i] = DECK[randInt];
			DECK[randInt] = temp;
		}

		var prevPlayers = 0;
		for (var i = 0; i < SEATS.length; i++) {
			if (SEATS[i] === null) {
				continue;
			}

			var info = $("#playerInfo" + i);
			info.removeClass("current");
			var cards = $("#playerCards" + i);

			for (var c = 6 * prevPlayers; c < 6 * prevPlayers + 6; c++) {
				var td = cards.find("td").eq(c % 6);
				RenderCard(td, DECK[c]);
			}

			prevPlayers++;
		}

		DRAW_INDEX = (6 * PLAYERS.length) + 1;
		DECK[DRAW_INDEX] = -DECK[DRAW_INDEX];

		var totalDealt = PLAYERS.length * 6;
		for (var i = 0; i < 2; i++) {
			RenderCard($("#centerCell .card").eq(i), DECK[DRAW_INDEX + i]);
		}

		setTimeout(function() {
			$(".playerInfo").css("opacity", "1");
		setTimeout(function() {
			$("#playerInfo" + DEALER + " img").css("border", "10px solid #ff0000").css("margin", "-7px -7px -7px -7px");
			$("#playerInfo" + DEALER + " .dealerLabel").show();
		setTimeout(function() {
			$(".playerInfoWrapper img").css("border", "").css("margin", "");
		setTimeout(function() {
			$("#playerInfo" + DEALER + " img").css("border", "10px solid #ff0000").css("margin", "-7px -7px -7px -7px");
		setTimeout(function() {
			$(".playerInfoWrapper img").css("border", "").css("margin", "");
		setTimeout(function() {
			$("#playerInfo" + DEALER + " img").css("border", "10px solid #ff0000").css("margin", "-7px -7px -7px -7px");
		setTimeout(function() {
			$(".playerInfoWrapper img").css("border", "").css("margin", "");
		setTimeout(function() {
			$("#playerInfo" + DEALER + " img").css("border", "10px solid #ff0000").css("margin", "-7px -7px -7px -7px");
		setTimeout(function() {
			$(".playerInfoWrapper img, .dealerLabel").animate({
		    	left:'0px',
		    	top:'0px',
			}, 1500);
			setTimeout(function() {
				$("#statusText").html("Dealing").hide();
				ShowHideNames();

				var delayTime = 0;
				var totalCards = 0;
				var firstPlayerSeat = CURRENT_SEAT;
				DRAWING_TWO = true;
				COUNTDOWN_TIME = (new Date()).getTime() + (31 * 1000);
				CLOCK_INTERVAL = setInterval(Countdown, 100);

				for (var q = 0; q < 6; q++) {
					for (var p = 0; p < SEATS.length; p++) {
						if (SEATS[p] === null) {
							continue;
						}

						var delay = (totalCards <= 3 ? 400 : (totalCards < PLAYERS.length ? 60 : 30));
						delayTime += delay;
						totalCards++;
						//console.log(CURRENT_SEAT);
						//console.log(CURRENT_SEAT + "x" + q + " - " + totalCards);
						DealCard($("#playerCards" + CURRENT_SEAT + " .card").eq(q), delayTime);

						if (totalCards < (6 * PLAYERS.length)) {
							IncrementCurrent(false);
						}
					}
				}

				setTimeout(function() {
					$(".playerName").css("opacity", "1");
					$(".playerInfoWrapper img").css("border", "").css("margin", "");
					$("#playerInfo" + DEALER + " .dealerLabel").hide();
					$("#playerInfo" + firstPlayerSeat).addClass("firstPlayer");
					$("#playerCards" + firstPlayerSeat).addClass("firstPlayer");

					EveryoneDrawTwo();
				}, delayTime + 1000);
	  		}, 1500);
		}, 700);
		}, 100);
		}, 100);
		}, 100);
		}, 100);
		}, 100);
		}, 100);
		}, 700);
		}, 1500);
	}

	function EveryoneDrawTwo() {
		for (var i = 0; i < SEATS.length; i++) {
			if (SEATS[i] === null) {
				continue;
			}

			if (SEATS[i].isLive) {
				$("#playerCards" + i + " .card").addClass("playableCard");
			}
			else {
				FlipTwoCards(i, false);
			}
		}
	}

	function FlipTwoCards(pSeatNum, pNow) {
		var delay = (pNow === true ? 0 : 1000 + Math.floor(Math.random() * 2000));
		setTimeout(function() {
			var upCardIndex = null;
			if (pNow === true) {
				var cards = GetPlayerCards(pSeatNum);
				for (var c = 0; c < 6; c++) {
					if (cards[c] > 0) {
						upCardIndex = c;
						break;
					}
				}
			}

			var rand1 = Math.floor(Math.random() * 6);
			if (upCardIndex !== null) {
				rand1 = upCardIndex;
			}
			var rand2 = null;
			while (rand2 === null || rand2 === rand1) {
				rand2 = Math.floor(Math.random() * 6);
			}

			if (upCardIndex === null) {
				FlipOverCard(pSeatNum, rand1);
			}

			FlipOverCard(pSeatNum, rand2);

			if (pNow !== true) {
				CheckForFlipTwoDone(false);
			}

		}, delay);
	}

	function CheckForFlipTwoDone(pForce) {
		var anyoneNotDone = false;
		for (var i = 0; i < SEATS.length; i++) {
			if (SEATS[i] === null) continue;
			var cards = GetPlayerCards(i);
			var numFaceUp = 0;

			for (var c = 0; c < 6; c++) {
				if (cards[c] > 0) {
					numFaceUp++;
				}
			}

			if (numFaceUp >= 2) {
				$("#playerCards" + i + " .card").removeClass("playableCard");
			}
			else {
				if (pForce) {
					FlipTwoCards(i, true);
				}
				else {
					anyoneNotDone = true;
				}
			}
		}

		if (!anyoneNotDone) {
			clearInterval(CLOCK_INTERVAL);
			setTimeout(function() {
				$("#statusText").html("").hide();
				$("#centerCell>span").show();
				$(".playerInfoWrapper img").css("border", "").css("margin", "");
				$(".firstPlayer").removeClass("firstPlayer");
				AdvanceToNextPlayer();
			}, 1000);
		}
	}

	function AdvanceToNextPlayer() {
		DRAWING_TWO = false;

		var cards = GetPlayerCards(CURRENT_SEAT);
		var anyFacedown = false;
		for (var i = 0; i < 6; i++) {
			if (cards[i] < 0) {
				anyFacedown = true;
				break;
			}
		}

		if (anyFacedown === false) {
			if (END_SEAT === null) {
				END_SEAT = CURRENT_SEAT;
				ShowAllCards();
			}
			$("#playerInfo" + CURRENT_SEAT).addClass("endplayer");
			$("#playerCards" + CURRENT_SEAT).addClass("endplayer");
			UpdateScore(CURRENT_SEAT);
		}

		// END OF PREVIOUS TURN - BEGIN NEXT TURN
		$(".playableCard").removeClass("playableCard");
		$(".selectedCard").removeClass("selectedCard");
		$(".discard").removeClass("discard");
		$(".card").css("opacity", 1);
		SELECTED_CARD = null;
		CheckAllCards();

		IncrementCurrent(true);
		if (END_SEAT !== null && END_SEAT === CURRENT_SEAT) {
			$(".current").removeClass("current");
			$(".endplayer").removeClass("endplayer");
			CURRENT_SEAT === null;
			ShowHideNames();
			if (ROUND_NUM <= 9) {
				$("#centerCell>span").hide();
				PREV_SHOW_SCORES = SHOW_SCORES;
				SHOW_SCORES = true;
				ShowHideNames();
				setTimeout(DrawRoundByRound, 2500);
				/*$("#statusText").html("End of Round " + ROUND_NUM).show();
				COUNTDOWN_TIME = (new Date()).getTime() + (121 * 1000); 
				CLOCK_INTERVAL = setInterval(Countdown, 100);*/
				//setTimeout(ShuffleUpAndDeal, 10000);
			}
			// End of hand
			setTimeout(function() {
				$(".playerInfo .playerName span").css("background-color", "").css("border-color", "");
			}, 1500);
		}
		else {
			if (SEATS[CURRENT_SEAT].isLive) {
				// Set playable cards for live player
				var cards = GetPlayerCards(CURRENT_SEAT);
				for (var i = 0; i < 6; i++) {
					if (cards[i] < 0) {
						$("#playerCards" + CURRENT_SEAT + " .card").eq(i).addClass("playableCard");
					}
				}

				$("#centerCell .card").addClass("playableCard");
			}
			else {
				setTimeout(OpponentMove, GetOpponentWaitDelay());
			}
		}
	}

	function Countdown() {
		var current = new Date();
		if (current >= COUNTDOWN_TIME) {
			clearInterval(CLOCK_INTERVAL);
			$("#statusText").html("").hide();
			if (DRAWING_TWO) {
				CheckForFlipTwoDone(true);
			}
			else {
				ShuffleUpAndDeal();
			}
		}
		else {
			timeDiff = (COUNTDOWN_TIME - current);
			var totalSeconds = Math.floor(timeDiff / 1000);
			var minutes = Math.floor(totalSeconds / 60);
			var seconds = totalSeconds % 60;
			var timeString = ("" + minutes + ":" + (seconds < 10 ? "0" : "") + seconds);

			var displayString = "Round " + (ROUND_NUM) + " begins in " + timeString;			
			displayString += "<br><br>You can use this time to flip<br>your 2 cards over, otherwise<br>2 random cards will be flipped.";
			$("#statusText").html(displayString).show();
		}
	}

	function GetSeatScore(pSeatNum) {
		var cards = GetPlayerCards(pSeatNum);
		var A = GetCardValue(cards[0]);
		var B = GetCardValue(cards[3]);
		var C = GetCardValue(cards[1]);
		var D = GetCardValue(cards[4]);
		var E = GetCardValue(cards[2]);
		var F = GetCardValue(cards[5]);

		if (A === B && B === C && C === D && D === E && E === F) {
			return -30;
		}

		scoresByColumn = [0,0,0];
		if (A !== B) { scoresByColumn[0] = GetCardPoints(A) + GetCardPoints(B); }
		if (C !== D) { scoresByColumn[1] = GetCardPoints(C) + GetCardPoints(D); }
		if (E !== F) { scoresByColumn[2] = GetCardPoints(E) + GetCardPoints(F); }

		var FourOfAKindScore = -20;
		if (A === B && B === C && C === D) { return scoresByColumn[2] + FourOfAKindScore; }
		else if (A === B && B === E && E === F) { return scoresByColumn[1] + FourOfAKindScore; }
		else if (C === D && D === E && E === F) { return scoresByColumn[0] + FourOfAKindScore; }
		else {
			return scoresByColumn[0] + scoresByColumn[1] + scoresByColumn[2];
		}
	}

	function UpdateScore(pSeatNum) {
		SEATS[pSeatNum].scores[ROUND_NUM - 1] = GetSeatScore(pSeatNum);
		var labelEl = $("#playerInfo" + pSeatNum).find(".playerName span");
		$.when(labelEl.fadeOut(200)).then(function() {
			setTimeout(function() {
				labelEl.html(GetPlayerLabelText(pSeatNum)).css("background-color", "#ffaaaa").css("border-color", "red");
				labelEl.fadeIn(200);
			}, 201);
		});
	}

	function GetCardValue(pCardIndex) {
		if (pCardIndex < 0) {
			return -1;
		}

		var deckVal = (pCardIndex - 1) % 54;

		if (deckVal > 51) {
			// Joker
			return 0;
		}
		else {
			return (1 + (deckVal % 13));
		}
	}

	function GetCardPoints(pCardVal) {
		if (pCardVal === 0) {
			return -3;
		}
		else if (pCardVal === 11) {
			return 20;
		}
		else if (pCardVal === 12) {
			return 10;
		}
		else if (pCardVal === 13) {
			return 0;
		}
		else {
			return pCardVal;
		}
	}

	function ShowAllCards() {
		for (var i = 0; i < 6 * PLAYERS.length; i++) {
			DECK[i] = Math.abs(DECK[i]);
		}

		var pCardNum = -1;
		for (var i = 0; i < SEATS.length; i++) {
			if (SEATS[i] === null) {
				continue;
			}

			for (var c = 0; c < 6; c++) {
				pCardNum++;
				RenderCard($("#playerCards" + i + " .card").eq(c), DECK[pCardNum]);
			}
		}
	}

	function OpponentMove() {
		var cards = GetPlayerCards(CURRENT_SEAT);
		var facedownIndices = [];
		var swapIndex = null;
		var faceUpVal = GetCardValue(DECK[DRAW_INDEX]);
		for (var i = 0; i < 6; i++) {
			if (cards[i] < 0) {
				facedownIndices.push(i);
			}
			else {
				var cardVal = GetCardValue(cards[i]);
				if (cardVal === faceUpVal && cardVal !== 0) {
					var oppositeIndex = (i + 3) % 6;
					var oppositeCard = cards[oppositeIndex];
					if (oppositeCard < 0) {
						swapIndex = oppositeIndex;
						break;
					}
					else {
						var oppositeVal = GetCardValue(oppositeCard);
						if ((oppositeVal !== 0 || (cardVal > 3 && cardVal < 13)) && oppositeVal !== cardVal) {
							swapIndex = oppositeIndex;
							break;
						}
					}
				}
			}
		}

		if (swapIndex !== null) {
			//console.log("Pair of " + faceUpVal + "'s to swap at " + (swapIndex + 1));
		}
		else {
			var swappable = [];
			for (var i = 0; i < 3; i++) {
				var A = GetCardValue(cards[i]);
				var B = GetCardValue(cards[i + 3]);

				if (A !== B || A < 0) {
					swappable.push(i);
					swappable.push(i + 3);
				}
			}
		}

		var randNum = Math.random();
		if (swapIndex !== null) {
			OpponentTakeDiscard(swapIndex);
		}
		else if (facedownIndices.length > 0 && randNum < 0.35) {
			FlipOverCard(CURRENT_SEAT, facedownIndices[Math.floor(Math.random() * facedownIndices.length)]);
		}
		else if (Math.random() < 0.5 || swappable.length <= 0) {
			OpponentDrawCard();
		}
		else {
			OpponentTakeDiscard(swappable[Math.floor(Math.random() * swappable.length)]);
		}
	}

	function GetOpponentWaitDelay() {
		return (END_SEAT === null ? 500 : 500);
	}

	function OpponentDrawCard() {
		FlipDrawCard(false);
	}

	function OpponentUseDrawCard() {
		var swapIndex = null;
		var drawVal = GetCardValue(DECK[DRAW_INDEX + 1]);
		var cards = GetPlayerCards(CURRENT_SEAT);

		for (var i = 0; i < 6; i++) {
			if (cards[i] > 0) {
				var cardVal = GetCardValue(cards[i]);
				if (cardVal === drawVal && cardVal !== 0) {
					var oppositeIndex = (i + 3) % 6;
					var oppositeCard = cards[oppositeIndex];
					if (oppositeCard < 0) {
						swapIndex = oppositeIndex;
						break;
					}
					else {
						var oppositeVal = GetCardValue(oppositeCard);
						if ((oppositeVal !== 0 || (cardVal > 3 && cardVal < 13)) && oppositeVal !== cardVal) {
							swapIndex = oppositeIndex;
							break;
						}
					}
				}
			}
		}

		if (swapIndex !== null) {
			//console.log("Pair of " + drawVal + "'s to swap at " + (swapIndex + 1));
		}
		else {
			var swappable = [6];
			for (var i = 0; i < 3; i++) {
				var A = GetCardValue(cards[i]);
				var B = GetCardValue(cards[i + 3]);

				if (A !== B || A < 0) {
					swappable.push(i);
					swappable.push(i + 3);
				}
			}
		}

		var swapWith = (swapIndex === null ? swappable[Math.floor(Math.random() * swappable.length)] : swapIndex);
		PlayDrawCard(swapWith);
	}

	function CheckForReshuffle() {
		if (DRAW_INDEX === 107) {
			console.log("Reshuffling");

			var currUpCard = DECK[DRAW_INDEX];
			var numPlayerCards = 6 * PLAYERS.length;
			DECK[DRAW_INDEX] = DECK[numPlayerCards];
			DECK[numPlayerCards] = currUpCard;
			DRAW_INDEX = numPlayerCards;

			for (var i = numPlayerCards + 1; i < 108; i++) {
				var randInt = i + Math.floor(Math.random() * (108-i));
				var temp = -Math.abs(DECK[i]);
				DECK[i] = -Math.abs(DECK[randInt]); // Make it negative to flip it face down
				DECK[randInt] = temp;
			}
		}
	}

	function PlayDrawCard(pCardIndex) {
		DRAW_INDEX++;
		CheckForReshuffle();

		if (pCardIndex > 5) {
			console.log(SEATS[CURRENT_SEAT].name + ": Discard the draw card");
			var centerCards = $("#centerCell .card");
			$.when(centerCards.fadeOut(200)).then(function() {
				$("#centerCell .card").eq(0).css("opacity", 1);
				$(".discard").removeClass("discard");
				RenderCard(centerCards.eq(0), DECK[DRAW_INDEX]);
				RenderCard(centerCards.eq(1), DECK[DRAW_INDEX + 1]);
				$.when(centerCards.fadeIn(200)).then(function() {
					AdvanceToNextPlayer();
				});
			});
		}
		else {
			console.log(SEATS[CURRENT_SEAT].name + ": Swap draw card at index " + (pCardIndex + 1));
			var oldPlayerCardIndex = GetPlayerIndex(CURRENT_SEAT) * 6 + pCardIndex;
			var oldPlayerCardVal = DECK[oldPlayerCardIndex];
			DECK[oldPlayerCardIndex] = DECK[DRAW_INDEX];
			DECK[DRAW_INDEX] = Math.abs(oldPlayerCardVal);

			var swapCards = $("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex).add($("#centerCell .card").eq(1));
			$.when(swapCards.fadeOut(200)).then(function() {
				//$("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex).css("background-color", "white");
				$(".discard").removeClass("discard");
				RenderCard($("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex), DECK[oldPlayerCardIndex]);
				RenderCard($("#centerCell .card").eq(1), DECK[DRAW_INDEX + 1]);
				$.when(swapCards.fadeIn(200)).then(function() {
					AdvanceToNextPlayer();
					setTimeout(function() {
						$("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex).css("background-color", "");
					}, 2000);
				});
			});
			var discard = $("#centerCell .card").eq(0);
			$.when(discard.fadeOut(200)).then(function() {
				discard.css("opacity", 1);
				RenderCard(discard, DECK[DRAW_INDEX]);
				discard.fadeIn(200);
			});
		}
	}

	function OpponentTakeDiscard(pCardIndex) {
		TakeDiscard(pCardIndex);
	}

	function TakeDiscard(pCardIndex) {
		console.log(SEATS[CURRENT_SEAT].name + ": Swap discard at index " + (pCardIndex + 1));
		if (pCardIndex >= 6) {
			console.trace();
		}
		var oldPlayerCardIndex = GetPlayerIndex(CURRENT_SEAT) * 6 + pCardIndex;
		var oldPlayerCardVal = DECK[oldPlayerCardIndex];
		DECK[oldPlayerCardIndex] = DECK[DRAW_INDEX];
		DECK[DRAW_INDEX] = Math.abs(oldPlayerCardVal);

		var swapCards = $("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex).add($("#centerCell .card").eq(0));
		$.when(swapCards.fadeOut(200)).then(function() {
			//$("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex).css("background-color", "white");
			RenderCard($("#playerCards" + CURRENT_SEAT + " .card").eq(pCardIndex), DECK[oldPlayerCardIndex]);
			RenderCard($("#centerCell .card").eq(0), DECK[DRAW_INDEX]);
			$.when(swapCards.fadeIn(200)).then(function() {
				AdvanceToNextPlayer();
				setTimeout(function() {
					swapCards.eq(0).css("background-color", "");
				}, 2000);
			});
		});
	}

	function FlipDrawCard(pIsLivePlayer) {
		console.log(SEATS[CURRENT_SEAT].name + ": Flip draw card");
		var drawCard = $("#centerCell .card").eq(1);
		var deckIndex = DRAW_INDEX + 1;
		var value = -DECK[deckIndex];
		DECK[deckIndex] = value;
		$.when(drawCard.fadeOut(200)).then(function() {
			//drawCard.css("background-color", "white");
			RenderCard(drawCard, value);
			$("#centerCell .card").eq(1).removeClass("playableCard");
			$.when(drawCard.fadeIn(200)).then(function() {
				if (pIsLivePlayer) {
					SELECTED_CARD = 1;
					$("#centerCell .card").eq(0).addClass("discard").html("").attr("title", "Discard");
					$(".live .card").addClass("playableCard");
				} else {
					setTimeout(OpponentUseDrawCard, GetOpponentWaitDelay());
					$("#centerCell .card").eq(0).css("opacity", 0.15);
				}

				setTimeout(function() {
					drawCard.css("background-color", "");
				}, 2000);
			});
		});
	}

	function ClickedDiscard() {
		if (SEATS[CURRENT_SEAT].isLive && $("#centerCell .card").eq(0).hasClass("playableCard")) {
			if (SELECTED_CARD === 1) {
				PlayDrawCard(6);
			}
			else if (SELECTED_CARD === 0) {
				$("#centerCell .card").eq(0).removeClass("selectedCard");
				$("#centerCell .card").eq(1).addClass("playableCard").css("opacity", 1);
				$(".live .card.faceup").removeClass("playableCard");
				SELECTED_CARD = null;
			}
			else if (SELECTED_CARD === null) {
				$("#centerCell .card").eq(0).addClass("selectedCard");
				$("#centerCell .card").eq(1).removeClass("playableCard").css("opacity", 0.15);
				$(".live .card").addClass("playableCard");
				SELECTED_CARD = 0;
			}
		}
	}

	function ClickedDrawCard() {
		if (SEATS[CURRENT_SEAT].isLive && $("#centerCell .card").eq(1).hasClass("playableCard")) {
			FlipDrawCard(true);
		}
	}

	function ClickedCard(pCardEl, pSeatNum, pCardNum) {
		if (!$(pCardEl).hasClass("playableCard")) {
			return;
		}

		if (DRAWING_TWO) {
			FlipOverCard(pSeatNum, pCardNum);
			CheckForFlipTwoDone(false);
		}
		else if (SEATS[CURRENT_SEAT].isLive && pSeatNum === CURRENT_SEAT) {
			if (SELECTED_CARD === null) {
				FlipOverCard(pSeatNum, pCardNum);
			}
			else if (SELECTED_CARD === 1) {
				PlayDrawCard(pCardNum);
			}
			else if (SELECTED_CARD === 0) {
				TakeDiscard(pCardNum);
			}
		}
	}

	function GetPlayerCards(pSeatNum) {
		var deckIndexStart = 6 * GetPlayerIndex(pSeatNum);
		var cards = [];
		for (var i = 0; i < 6; i++) {
			cards.push(DECK[deckIndexStart + i]);
		}

		return cards;
	}

	function DealCard(card, delayTime) {
		setTimeout(function() {
			card.css("opacity", "1");
		}, delayTime);
	}

	function ToggleNames() {
		SHOW_NAMES = !SHOW_NAMES;
		ShowHideNames();
	}

	function ToggleScores() {
		SHOW_SCORES = !SHOW_SCORES;
		ShowHideNames();
	}

	function ShowHideNames() {
		console.log("ShowHideNames");
		$(".playerName").toggle(SHOW_SCORES || SHOW_NAMES);

		for (var i = 0; i < SEATS.length; i++) {
			var label = $("#playerInfo" + i).find(".playerName span");
			if (SEATS[i] === null) {
				label.hide();
			}
			else {
				label.html(GetPlayerLabelText(i));
			}
		}
	}

	function GetPlayerLabelText(pSeatNum) {
		var roundScores = SEATS[pSeatNum].scores;
		var total = 0;
		for (var i = 0; i < 9; i++) {
			total += roundScores[i];
		}
		return (SHOW_NAMES ? SEATS[pSeatNum].name : "") + (SHOW_SCORES ? " <strong>" + total + "</strong>" : "");
	}

	function CheckAllCards() {
		$(".card").each(function() {
			CheckCard($(this));
		});
	}

	function CheckCard(cardEl, value) {
		if (typeof cardEl.attr("seatNum") !== "undefined") {
			var deckIndex = 6 * GetPlayerIndex(parseInt(cardEl.attr("seatNum"))) + parseInt(cardEl.attr("cardNum"));
			if (typeof value !== "undefined" && DECK[deckIndex] != value) {
				console.log(SEATS[parseInt(cardEl.attr("seatNum"))].name + " (" + (1 + parseInt(cardEl.attr("cardNum"))) + "): " + value + " should be " + DECK[deckIndex]);
			}

			if (typeof cardEl.attr("cardVal") !== "undefined") {
				var cardVal = parseInt(cardEl.attr("cardVal"));
				if (DECK[deckIndex] !== cardVal) {
					console.log(SEATS[parseInt(cardEl.attr("seatNum"))].name + " (" + (1 + parseInt(cardEl.attr("cardNum"))) + "): showing as " + cardVal + " should be " + DECK[deckIndex]);
				}
			}
		}
	}

	function RenderCard(td, value) {
		td.attr("cardVal", value);
		CheckCard(td, value);
		td.removeClass("red").removeClass("black").removeClass("deck1").removeClass("deck2").removeClass("facedown").removeClass("faceup").removeClass("joker").attr("title", "");
		var isFaceDown = (value < 0);
		value = Math.abs(value);

		if (isFaceDown) {
			td.addClass("facedown").addClass(value < 54 ? "deck1" : "deck2");
			td.html("");
		}
		else {
			td.addClass("faceup");
			var cardVal = (value - 1) % 54;
			if (cardVal > 51) {
				td.addClass("joker");
				td.html("<span class='jokerText'>J<span style='color:red'>O</span>K<span style='color:red'>E</span>R</span><br><span style='color:black'>♠</span><span style='color:red'>♥</span><br><span style='color:red'>♦</span><span style='color:black'>♣</span>");
			}
			else {
				var suit = Math.floor(cardVal / 13);
				td.html(VALS[cardVal % 13] + '<div class="suit">' + SUITS[suit] + '</div>')
				  .addClass(suit % 2 == 1 ? "black" : "red");
			}
		}

		ResizeCards();
	}

	function SafeFitToWindow() {
		FitToWindow(false);
	}

	function FitToWindow(pOnPageLoad) {
		var currWindowSize = window.innerWidth;

		if (currWindowSize === LAST_WINDOW_SIZE && pOnPageLoad !== true) {
			return;
		}


		LAST_RESIZE = new Date();
		var currTime = LAST_RESIZE; 
		setTimeout(function() {
			if (currTime !== LAST_RESIZE) {
				return;
			}
			LAST_WINDOW_SIZE = window.innerWidth;
			ResizeText();
			var idealMiddle = 0.575;
			var tableHeight = $("#playTable").height();
			var imageHeight = $("#bgPhoto").height();
			var windowHeight = window.innerHeight;
			var percentHeight = (tableHeight / imageHeight);
			var marginTopPercent = idealMiddle - (percentHeight / 2);
			var marginTopPixels = marginTopPercent * imageHeight;

			if (tableHeight > imageHeight) {
				marginTopPixels = -($("#playTableContainer").position().top);
			}
			else if (marginTopPixels + tableHeight > imageHeight) {
				marginTopPixels = imageHeight - tableHeight - ($("#playTableContainer").position().top) - 2;
			}

			/*console.log(idealMiddle);
			console.log(tableHeight);
			console.log(imageHeight);
			console.log(windowHeight);
			console.log(percentHeight);
			console.log(marginTopPercent);
			console.log(marginTopPixels);*/
			$("#playTableContainer").css("margin-top", marginTopPixels + "px");

			var scrollTo = marginTopPixels + tableHeight - windowHeight + 10;

			if (windowHeight > tableHeight) {
				scrollTo += ((windowHeight - tableHeight) / 2);
			} else if (tableHeight > imageHeight) {
				scrollTo = (tableHeight - windowHeight) / 2;
			}

            if (pOnPageLoad == true) {
	            $('body').animate({
	                scrollTop: scrollTo
		        }, 1500);
            }
            else {
                window.scroll(0, scrollTo);
	            /*var ua = window.navigator.userAgent.toLowerCase();
	            if (ua.indexOf("trident") >= 0 || ua.indexOf("edge") >= 0) {
	                // IE and Edge don't support smooth animated scrolling - just set the scroll
	                window.scroll(0, scrollTo);
	            }
	            else {
	                window.scroll({ top: scrollTo, behavior: 'smooth' });
	            }*/
            }

		}, 100);
	}

	function GetPlayerIndex(pSeatNum) {
		var playerNum = -1;
		for (var s = 0; s <= pSeatNum; s++) {
			if (SEATS[s] !== null) {
				playerNum++;
			}
		}

		return playerNum;
	}

	function FlipOverCard(pSeatNum, pCardNum) {
		console.log(SEATS[pSeatNum].name + ": Flip over card #" + (pCardNum + 1));
		var cards = $("#playerCards" + pSeatNum);
		var card = cards.find(".card").eq(pCardNum);
		var deckIndex = 6 * GetPlayerIndex(pSeatNum) + pCardNum;
		var value = -DECK[deckIndex];
		DECK[deckIndex] = value;
		card.fadeOut(200, function() {
			RenderCard(card, value);
		});
		card.fadeIn(200, function() {
			if (!DRAWING_TWO) {
				AdvanceToNextPlayer();
			}
		});
	}

	function IncrementCurrent(pHighlight = false) {
		//console.log("Incrementing");
		var started = true;
		while (started === true || SEATS[CURRENT_SEAT] === null) {
			started = false;
			CURRENT_SEAT += 1;
			CURRENT_SEAT %= TOTAL_SEATS;
		}
		//console.log("Done Incrementing");

		$(".current").removeClass("current");

		if (pHighlight) {
			$("#playerInfo" + CURRENT_SEAT).addClass("current");
			$("#playerCards" + CURRENT_SEAT).addClass("current");
		}
	}

	function ResizeText() {
		var idealWidth = 1270;
		var actualWidth = window.innerWidth;
		var scale = (actualWidth / idealWidth);

		var photoHeight = scale * 80;
		if (photoHeight > 100) {
			photoHeight = 100;
		}
		if (photoHeight < 50) {
			photoHeight = 50;
		}

		$(".playerInfo img").css("max-height", photoHeight + "px");
		$(".playerName, #centerCell").css("font-size", (scale * 12 < 10 ? 10 : scale * 12) + "pt");

		ResizeCards();
	}

	function ResizeCards() {
		var idealWidth = 1270;
		var actualWidth = window.innerWidth;
		var scale = (actualWidth / idealWidth);

		// Compensate for line thickness
		if (scale > 1) {
			scale *= 1.02;
		}
		else {
			scale /= 1.02;
		}

		var suitScale = $("#widthTestValue").width() / $("#widthTestSuit").width() * 1.25;

		// Card 24 pt
		// Suit (24 * scale) pt since different browsers render them different sizes
		// Joker 8 pt
		// Name 12 pt

		$(".card").css("font-size", (scale * 24) + "pt").css("padding-bottom", (scale * 5) + "px");
		$(".jokerText").css("font-size", (scale * 8) + "pt");
		$(".suit").css("font-size", (scale * suitScale * 24) + "pt");
		$(".joker>span").not(".jokerText").css("font-size", (scale * suitScale * 12) + "pt");
	}

	function ShowRoundByRound() {
		$("#roundByRoundCloseButton").html(ROUND_NUM < 9 ? ("Begin Round " + (ROUND_NUM + 1)) : "Close");
		$(".overlayContent").hide();
		$("#roundByRound").show();
		ShowOverlay();
	}

	function ShowOverlay() {
		var imageHeight = $("#bgPhoto").height();
		var windowHeight = window.innerHeight;
		var overlayHeight = (imageHeight > windowHeight ? imageHeight : windowHeight);
		$(".overlayContent").css("top", window.scrollY);
		$("#overlayContainer").css("height", "" + overlayHeight + "px").fadeIn(500);
	}

	function HideOverlay() {
		$("#overlayContainer").fadeOut(500);
		SafeFitToWindow();
	}
</script>

</html>